name: Check

on:
  pull_request:

jobs:
  path-check:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
    - name: Check modified files
      run: |
        # Get list of changed files
        CHANGED_FILES=$(git diff --name-only origin/${{ github.base_ref }}...HEAD)

        # Check if any file is outside data/ directory
        INVALID_FILES=$(echo "$CHANGED_FILES" | grep -v '^"\\?data/' || true)

        if [ -n "$INVALID_FILES" ]; then
          echo "❌ Error: Pull requests can only modify files under data/ directory"
          echo ""
          echo "The following files are not allowed to be modified:"
          echo "$INVALID_FILES"
          exit 1
        fi

        echo "✅ All modified files are under data/ directory"

  check:
    runs-on: ubuntu-latest
    needs: path-check
    steps:
    - name: Checkout
      uses: actions/checkout@v3
    - name: Test
      run: |
        npm install
        npm test